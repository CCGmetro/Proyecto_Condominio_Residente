<script>
function setupAuthEventListeners(alertModal) {
  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', (e) => handleLogin(e, alertModal));
  }
}

function handleLogin(e, alertModal) {
  e.preventDefault();
  const loginButton = document.getElementById('loginButton');
  const rut = document.getElementById('rut').value.trim();
  const password = document.getElementById('password').value;

  if (!rut || !password) {
    showAlert('Atención', 'Por favor, completa todos los campos.', alertModal);
    return;
  }

  showButtonLoading(loginButton, true, 'Ingresar');
  localStorage.removeItem('appData'); 

  google.script.run
    .withSuccessHandler((response) => {
      showButtonLoading(loginButton, false, 'Ingresar');
      if (response.success) {
        localStorage.setItem('residentRut', response.rut);
        loadAndRenderInitialData(response.rut);
      } else {
        showAlert('Error de Ingreso', response.message, alertModal);
      }
    })
    .withFailureHandler((err) => {
      showButtonLoading(loginButton, false, 'Ingresar');
      showAlert('Error de Conexión', 'No se pudo comunicar con el servidor. Intenta de nuevo.', alertModal);
    })
    .login(rut, password);
}

function handleLogout() {
  localStorage.removeItem('residentRut');
  localStorage.removeItem('appData');
  window.location.reload();
}
</script>